<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Hỏi Đáp - Hiểu Về Trái Tim</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            align-items: start;
        }

        .chat-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .chat-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .chat-messages {
            height: 500px;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 20px;
            position: relative;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border: 1px solid #e1e5e9;
            border-bottom-left-radius: 5px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            font-size: 1.2rem;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.bot .message-avatar {
            background: #f8f9fa;
            color: #667eea;
        }

        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e1e5e9;
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Sidebar styles */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .status-panel, .admin-panel, .suggestions {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .panel-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-weight: 600;
            color: #333;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-indicator.success {
            background: #28a745;
        }

        .status-indicator.warning {
            background: #ffc107;
        }

        .status-indicator.error {
            background: #dc3545;
        }

        .admin-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .admin-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .admin-btn.secondary {
            background: #f8f9fa;
            color: #667eea;
            border: 1px solid #e1e5e9;
        }

        .admin-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .admin-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .suggestion-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .suggestion-tag {
            background: #f8f9fa;
            color: #667eea;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.85rem;
            border: 1px solid #e1e5e9;
            transition: all 0.3s ease;
        }

        .suggestion-tag:hover {
            background: #667eea;
            color: white;
            transform: translateY(-1px);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .loading i {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 10px 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #c33;
        }

        .success {
            background: #efe;
            color: #3c3;
            padding: 10px 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #3c3;
        }

        .timestamp {
            font-size: 0.8rem;
            color: #999;
            margin-top: 5px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .chat-container {
                border-radius: 15px;
            }
            
            .message-content {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-heart"></i> Hệ Thống Hỏi Đáp</h1>
            <p>Khám phá nội dung sách "Hiểu Về Trái Tim" - Minh Niệm</p>
        </div>

        <div class="main-content">
            <div class="chat-container">
                <div class="chat-header">
                    <h2><i class="fas fa-comments"></i> Trò chuyện với AI</h2>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <div class="message bot">
                        <div class="message-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            Xin chào! Tôi là trợ lý AI được thiết kế để giúp bạn khám phá nội dung sách "Hiểu Về Trái Tim" của tác giả Minh Niệm. Bạn có thể hỏi tôi bất kỳ câu hỏi nào về nội dung sách, tác giả, hoặc các chủ đề liên quan đến tâm lý, hạnh phúc và cuộc sống.
                            <div class="timestamp">Bây giờ</div>
                        </div>
                    </div>
                </div>

                <div class="loading" id="loading">
                    <i class="fas fa-spinner fa-2x"></i>
                    <p>Đang tìm kiếm thông tin...</p>
                </div>

                <div class="input-container">
                    <div class="input-group">
                        <input type="text" id="queryInput" class="input-field" placeholder="Nhập câu hỏi của bạn..." maxlength="500">
                        <button id="sendBtn" class="send-btn">
                            <i class="fas fa-paper-plane"></i>
                            Gửi
                        </button>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <!-- Status Panel -->
                <div class="status-panel">
                    <div class="panel-header">
                        <i class="fas fa-chart-line"></i>
                        <span>Trạng thái hệ thống</span>
                    </div>
                    <div id="statusContent">
                        <div class="status-item">
                            <span>Đang kiểm tra...</span>
                            <div class="status-indicator warning"></div>
                        </div>
                    </div>
                </div>

                <!-- Admin Panel -->
                <div class="admin-panel">
                    <div class="panel-header">
                        <i class="fas fa-cog"></i>
                        <span>Quản lý dữ liệu</span>
                    </div>
                    <button id="updateDbBtn" class="admin-btn primary">
                        <i class="fas fa-sync-alt"></i>
                        Cập nhật Database
                    </button>
                    <button id="checkStatusBtn" class="admin-btn secondary">
                        <i class="fas fa-info-circle"></i>
                        Kiểm tra trạng thái
                    </button>
                </div>

                <!-- Suggestions -->
                <div class="suggestions">
                    <div class="panel-header">
                        <i class="fas fa-lightbulb"></i>
                        <span>Câu hỏi gợi ý</span>
                    </div>
                    <div class="suggestion-tags" id="suggestionTags">
                        <!-- Sẽ được populate bằng JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const queryInput = document.getElementById('queryInput');
        const sendBtn = document.getElementById('sendBtn');
        const loading = document.getElementById('loading');
        const suggestionTags = document.getElementById('suggestionTags');
        const statusContent = document.getElementById('statusContent');
        const updateDbBtn = document.getElementById('updateDbBtn');
        const checkStatusBtn = document.getElementById('checkStatusBtn');

        // Load suggestions
        fetch('/api/suggestions')
            .then(response => response.json())
            .then(data => {
                data.suggestions.forEach(suggestion => {
                    const tag = document.createElement('div');
                    tag.className = 'suggestion-tag';
                    tag.textContent = suggestion;
                    tag.onclick = () => {
                        queryInput.value = suggestion;
                        sendMessage();
                    };
                    suggestionTags.appendChild(tag);
                });
            });

        // Check system status on load
        checkSystemStatus();

        function checkSystemStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    updateStatusPanel(data);
                })
                .catch(error => {
                    console.error('Lỗi khi kiểm tra trạng thái:', error);
                });
        }

        function updateStatusPanel(status) {
            statusContent.innerHTML = '';
            
            const items = [
                {
                    label: 'File dữ liệu',
                    value: status.data_file_exists ? 'Có' : 'Không',
                    status: status.data_file_exists ? 'success' : 'error'
                },
                {
                    label: 'Vector Database',
                    value: status.vector_db_exists ? 'Có' : 'Không',
                    status: status.vector_db_exists ? 'success' : 'error'
                },
                {
                    label: 'Hệ thống',
                    value: status.system_ready ? 'Sẵn sàng' : 'Chưa sẵn sàng',
                    status: status.system_ready ? 'success' : 'warning'
                }
            ];

            if (status.data_size_mb) {
                items.push({
                    label: 'Kích thước dữ liệu',
                    value: `${status.data_size_mb} MB`,
                    status: 'success'
                });
            }

            items.push({
                label: 'Cập nhật lần cuối',
                value: status.timestamp || 'Không xác định',
                status: 'success'
            });

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'status-item';
                div.innerHTML = `
                    <span>${item.label}</span>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span>${item.value}</span>
                        <div class="status-indicator ${item.status}"></div>
                    </div>
                `;
                statusContent.appendChild(div);
            });
        }

        function addMessage(content, isUser = false, timestamp = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.innerHTML = isUser ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.innerHTML = content;
            
            if (timestamp) {
                const timeDiv = document.createElement('div');
                timeDiv.className = 'timestamp';
                timeDiv.textContent = timestamp;
                messageContent.appendChild(timeDiv);
            }
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function sendMessage() {
            const query = queryInput.value.trim();
            if (!query) return;

            // Add user message
            addMessage(query, true, new Date().toLocaleTimeString('vi-VN'));
            
            // Clear input
            queryInput.value = '';
            
            // Show loading
            loading.style.display = 'block';
            sendBtn.disabled = true;
            
            // Send request
            fetch('/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ query: query })
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                sendBtn.disabled = false;
                
                if (data.error) {
                    addMessage(`<div class="error">${data.error}</div>`, false, data.timestamp);
                } else {
                    addMessage(data.answer, false, data.timestamp);
                }
            })
            .catch(error => {
                loading.style.display = 'none';
                sendBtn.disabled = false;
                addMessage(`<div class="error">Lỗi kết nối: ${error.message}</div>`, false);
            });
        }

        // Update database function
        function updateDatabase() {
            updateDbBtn.disabled = true;
            updateDbBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang cập nhật...';
            
            fetch('/api/update-database', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addMessage(`<div class="success">${data.message}</div>`, false);
                    checkSystemStatus();
                } else {
                    addMessage(`<div class="error">${data.message}</div>`, false);
                }
            })
            .catch(error => {
                addMessage(`<div class="error">Lỗi: ${error.message}</div>`, false);
            })
            .finally(() => {
                updateDbBtn.disabled = false;
                updateDbBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Cập nhật Database';
            });
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        updateDbBtn.addEventListener('click', updateDatabase);
        checkStatusBtn.addEventListener('click', checkSystemStatus);
        
        queryInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Focus input on load
        queryInput.focus();
    </script>
</body>
</html> 